stat_summary(fun = mean_cl_normal)
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal)
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal,color ="red",geom = "point_range")
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal,color ="red",geom = "pointrange")
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal,color ="red",geom = "pointrange") +
theme_ohchibi()
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal,color ="red",geom = "pointrange") +
theme_ohchibi() +
theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
)
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal,color ="red",geom = "pointrange") +
theme_ohchibi() +
theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
) +
xlab(label = "Time")
ggplot(data = melted,aes(Var2,value)) +
stat_summary(fun.data = mean_cl_normal,color ="red",geom = "pointrange",sizr = 0.5) +
theme_ohchibi() +
theme(
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
) +
xlab(label = "Time")
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
######Define color for the genotypes
paleta_gen <- c("#A6CEE3", "#60FDF4",
"#B565F0","#1F74F0",
"#E5C494", "#8CD17D",
"#FDB462", "#F1CE63",
"#499894", "#86BCB6", "#E15759",
"#E03558","#79706E", "#BAB0AC", "#D37295",
"#FABFD2", "#DAA520")
names(paleta_gen) <- c("Col-0", "WS",
"bik1", "Si81psl1",
"phf1", "phr1",
"phr1/phl1", "pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 2-1",
"pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 3-1",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #1-2",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #2-3",
"pht1,1", "pht1,1;1,4", "pht1,4", "pht1,4/S1-L11_138643",
"pht1,4/SAIL_1225_G08", "Bulk soil")
palette_variance <- paletteer_d("dutchmasters::pearl_earring",11)[c(1:4,7)] %>%
c(.,"white")
names(palette_variance) <- c("Fraction","Genotype","Phosphate",
"Fraction:Phosphate","Fraction:Genotype","Residual")
distfun <- function(x,method) vegan::vegdist(x = x, method = "bray")
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat$RawCounts$Map
Dat$RawCounts$Map
Mapa ;' Dat$RawCounts$Map
Mapa <- Dat$RawCounts$Map
Mapa
write.table(x = Map,file = "~/Documents/map.tsv",append = F,quote = F,sep = "\t",row.names = F,col.names = F)
head(Map)
write.table(x = Mapa,file = "~/Documents/map.tsv",append = F,quote = F,sep = "\t",row.names = F,col.names = F)
Mapa
head(Map)
Mapa
head(Mapa)
paste0(Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep)
Mapa$Genotype
Mapa$Genotype %>% unique
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
######Define color for the genotypes
paleta_gen <- c("#A6CEE3", "#60FDF4",
"#B565F0","#1F74F0",
"#E5C494", "#8CD17D",
"#FDB462", "#F1CE63",
"#499894", "#86BCB6", "#E15759",
"#E03558","#79706E", "#BAB0AC", "#D37295",
"#FABFD2", "#DAA520")
names(paleta_gen) <- c("Col-0", "WS",
"bik1", "Si81psl1",
"phf1", "phr1",
"phr1/phl1", "pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 2-1",
"pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 3-1",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #1-2",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #2-3",
"pht1,1", "pht1,1;1,4", "pht1,4", "pht1,4/S1-L11_138643",
"pht1,4/SAIL_1225_G08", "Bulk soil")
palette_variance <- paletteer_d("dutchmasters::pearl_earring",11)[c(1:4,7)] %>%
c(.,"white")
names(palette_variance) <- c("Fraction","Genotype","Phosphate",
"Fraction:Phosphate","Fraction:Genotype","Residual")
distfun <- function(x,method) vegan::vegdist(x = x, method = "bray")
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_rar <- Dat$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_rar %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_sub
Dat_sub$Map
Dat_sub$Map %>% dim
perro <- Dat_sub$Map
perro$UiD
perro$DADA_Header
perro$Genotype
Mapa <- perro
paste0(Mapa$Fraction)
paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype)
paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep)
paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep)
paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep,"_",Mapa$Plate)
paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep,"_",Mapa$Plate,"_",Mapa$PosNum)
paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep,"_",Mapa$Plate,"",Mapa$PosNum,"",Mapa$PosWell)
Mapa$SampleId <- paste0(Mapa$Fraction,"_",Mapa$Background,"_",Mapa$Genotype,"_",Mapa$Rep,"_",Mapa$Plate,"",Mapa$PosNum,"",Mapa$PosWell)
write.table(x = Mapa,file = "~/Documents/map.tsv",append = F,quote = F,sep = "\t",row.names = F,col.names = F)
Mapa
rm(list=ls())
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
######Define color for the genotypes
paleta_gen <- c("#A6CEE3", "#60FDF4",
"#B565F0","#1F74F0",
"#E5C494", "#8CD17D",
"#FDB462", "#F1CE63",
"#499894", "#86BCB6", "#E15759",
"#E03558","#79706E", "#BAB0AC", "#D37295",
"#FABFD2", "#DAA520")
names(paleta_gen) <- c("Col-0", "WS",
"bik1", "Si81psl1",
"phf1", "phr1",
"phr1/phl1", "pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 2-1",
"pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 3-1",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #1-2",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #2-3",
"pht1,1", "pht1,1;1,4", "pht1,4", "pht1,4/S1-L11_138643",
"pht1,4/SAIL_1225_G08", "Bulk soil")
palette_variance <- paletteer_d("dutchmasters::pearl_earring",11)[c(1:4,7)] %>%
c(.,"white")
names(palette_variance) <- c("Fraction","Genotype","Phosphate",
"Fraction:Phosphate","Fraction:Genotype","Residual")
distfun <- function(x,method) vegan::vegdist(x = x, method = "bray")
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_rar <- Dat$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_rar %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_sub
rm(list=ls())
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_rar <- Dat$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_rar %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rar <- Dat_sub
Dat_sub <- Dat$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_sub
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_raw <- Dat_temp
Dat_temp <- Dat$Rarefied
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rar <- Dat_temp
Dat_temp <- Dat$RelativeAbundance
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rab <- Dat_temp
Dat$df_tax
df_tax <- Dat$df_tax
Dat_raw$Tax$ASV
match(Dat_raw$Tax$ASV,df_tax$ASV)
match(Dat_raw$Tax$ASV,df_tax$ASV) %>%
df_tax[.,]
match(Dat_raw$Tax$ASV,df_tax$ASV) %>%
df_tax[.,] %>% dropelvels
df_tax <- match(Dat_raw$Tax$ASV,df_tax$ASV) %>%
df_tax[.,] %>% droplevels
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_raw <- Dat_temp
Dat_temp <- Dat$Rarefied
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rar <- Dat_temp
Dat_temp <- Dat$RelativeAbundance
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rab <- Dat_temp
df_tax <- Dat$df_tax
df_tax <- match(Dat_raw$Tax$ASV,df_tax$ASV) %>%
df_tax[.,] %>% droplevels
mlist <- list(
RawCounts = Dat_raw,
Rarefied = Dat_rar,
RelativeAbundance = Dat_rab,
df_tax = df_tax
)
library(ohchibi)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_raw <- Dat_temp
Dat_temp <- Dat$Rarefied
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rar <- Dat_temp
Dat_temp <- Dat$RelativeAbundance
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rab <- Dat_temp
df_tax <- Dat$df_tax
df_tax <- match(Dat_raw$Tax$ASV,df_tax$ASV) %>%
df_tax[.,] %>% droplevels
mlist <- list(
RawCounts = Dat_raw,
Rarefied = Dat_rar,
RelativeAbundance = Dat_rab,
df_tax = df_tax
)
saveRDS(object = mlist,file = "../cleandata/dat_asv_Pht1-BIK.RDS")
Dat <- readRDS(file = "../cleandata/dat_asv_Pht1-BIK.RDS")
Dat_rar <- Dat$Rarefied %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_rar
Dat_rar$Tab
Dat_rar$Map$Fraction
Dat_rar$Map$Fraction %>% unique
library(ohchibi)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
Dat <- readRDS(file = "../cleandata/dat_asv_phosphate.RDS")
Dat_temp <- Dat$RawCounts
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_raw <- Dat_sub
Dat_temp <- Dat$Rarefied
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rar <- Dat_sub
Dat_temp <- Dat$RelativeAbundance
Dat_sub <- Dat_temp %>%
subset.Dataset(Genotype == "Col-0" | Genotype == "WS" | Genotype == "Si81" | Genotype == "pht1,1;1,4")
Dat_sub <-  Dat_sub %>%
subset.Dataset(Fraction == "Root",drop = T,clean = T)
Dat_rab <- Dat_sub
df_tax <- Dat$df_tax
df_tax <- match(Dat_raw$Tax$ASV,df_tax$ASV) %>%
df_tax[.,] %>% droplevels
mlist <- list(
RawCounts = Dat_raw,
Rarefied = Dat_rar,
RelativeAbundance = Dat_rab,
df_tax = df_tax
)
saveRDS(object = mlist,file = "../cleandata/dat_asv_Pht1-BIK.RDS")
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
setwd('/Users/isaisalasgonzalez/Documents/salas/Pht1-BIK/scripts/')
######Define color for the genotypes
paleta_gen <- c("#A6CEE3", "#60FDF4",
"#B565F0","#1F74F0",
"#E5C494", "#8CD17D",
"#FDB462", "#F1CE63",
"#499894", "#86BCB6", "#E15759",
"#E03558","#79706E", "#BAB0AC", "#D37295",
"#FABFD2", "#DAA520")
names(paleta_gen) <- c("Col-0", "WS",
"bik1", "Si81psl1",
"phf1", "phr1",
"phr1/phl1", "pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 2-1",
"pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 3-1",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #1-2",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #2-3",
"pht1,1", "pht1,1;1,4", "pht1,4", "pht1,4/S1-L11_138643",
"pht1,4/SAIL_1225_G08", "Bulk soil")
palette_variance <- paletteer_d("dutchmasters::pearl_earring",11)[c(1:4,7)] %>%
c(.,"white")
names(palette_variance) <- c("Fraction","Genotype","Phosphate",
"Fraction:Phosphate","Fraction:Genotype","Residual")
distfun <- function(x,method) vegan::vegdist(x = x, method = "bray")
Dat <- readRDS(file = "../cleandata/dat_asv_Pht1-BIK.RDS")
Dat$Rarefied$Map
Dat$Rarefied$Map$Fraction
Dat$Rarefied$Map$Genotype
Dat_raw$Tab
write.table(x = Dat_raw$Tab,file = "../rawdata/matrix_asv_Pht1-BIK.tsv",
append = F,quote = F,sep = "\t",row.names = T,col.names = T)
write.table(x = Dat_raw$Map,file = "../rawdata/metadata_asv_Pht1-BIK.tsv",
append = F,quote = F,sep = "\t",row.names = T,col.names = T)
write.table(x = Dat_raw$Map,file = "../rawdata/metadata_asv_Pht1-BIK.tsv",
append = F,quote = F,sep = "\t",row.names = F,col.names = T)
write.table(x = df_tax,file = "../rawdata/taxonomy_asv_Pht1-BIK.tsv",
append = F,quote = F,sep = "\t",row.names = F,col.names = T)
dev.off()
rm(list=ls())
gc()
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
set.seed(130816)
######Define color for the genotypes
paleta_gen <- c("#A6CEE3", "#60FDF4",
"#B565F0","#1F74F0",
"#E5C494", "#8CD17D",
"#FDB462", "#F1CE63",
"#499894", "#86BCB6", "#E15759",
"#E03558","#79706E", "#BAB0AC", "#D37295",
"#FABFD2", "#DAA520")
names(paleta_gen) <- c("Col-0", "WS",
"bik1", "Si81psl1",
"phf1", "phr1",
"phr1/phl1", "pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 2-1",
"pht1,1;1,4/pPHT1,4:PHT1,4 GFP # 3-1",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #1-2",
"pht1,1;1,4/pPHT1,4:PHT1,4;S258A - GFP #2-3",
"pht1,1", "pht1,1;1,4", "pht1,4", "pht1,4/S1-L11_138643",
"pht1,4/SAIL_1225_G08", "Bulk soil")
palette_variance <- paletteer_d("dutchmasters::pearl_earring",11)[c(1:4,7)] %>%
c(.,"white")
names(palette_variance) <- c("Fraction","Genotype","Phosphate",
"Fraction:Phosphate","Fraction:Genotype","Residual")
distfun <- function(x,method) vegan::vegdist(x = x, method = "bray")
Dat <- readRDS(file = "../cleandata/dat_asv_Pht1-BIK.RDS")
Dat_rar <- Dat$Rarefied
#Permanova
Tab_bray <- distfun(t(Dat_sub$Tab))
Dat_sub <- Dat$Rarefied
#Permanova
Tab_bray <- distfun(t(Dat_sub$Tab))
mypermanova <- adonis(Tab_bray ~   Genotype + Rep ,
data = Dat_sub$Map,
#strata = Dat_sub$Map$Rep,
permutations = 9999)
mypermanova
mcap <- oh.cap(Tab = Dat_sub$Tab ,Map = Dat_sub$Map ,
formula = "Genotype + Condition(Rep)",
distfun = distfun,perms = 9999)
#Summary plot
Map_cap <- mcap$Map_cap
df_1 <- summarySE(data = Map_cap,measurevar = "CAP1",groupvars = "Genotype")
df_2 <- summarySE(data = Map_cap,measurevar = "CAP2",groupvars = "Genotype")
df_3 <- summarySE(data = Map_cap,measurevar = "CAP3",groupvars = "Genotype")
df_4 <- summarySE(data = Map_cap,measurevar = "CAP4",groupvars = "Genotype")
merged <- merge(df_1[,c("Genotype","CAP1","ci")],df_2[,c("Genotype","CAP2","ci")],by = "Genotype")
colnames(merged)[c(3,5)] <- c("ci.CAP1","ci.CAP2")
xlab_id <- paste0("CAP1 (",mcap$variance_explained_axis[1],"%)")
ylab_id <- paste0("CAP2 (",mcap$variance_explained_axis[2],"%)")
annotation_id <- paste0("R2 = ",round(mypermanova$aov.tab$R2[1],2),"\n","p = ",
format.pval(mypermanova$aov.tab$`Pr(>F)`[1]))
merged$Background <- match(merged$Genotype,Dat_sub$Map$Genotype) %>%
Dat_sub$Map$Background[.]
merged$Genotype <- merged$Genotype %>%
gsub(pattern = "Si81",replacement = "bik1") %>%
factor(levels = c("Col-0","bik1","WS","pht1,1;1,4"))
mcap$Map_cap$Genotype <- mcap$Map_cap$Genotype %>%
gsub(pattern = "Si81",replacement = "bik1") %>%
factor(levels = c("Col-0","bik1","WS","pht1,1;1,4"))
p1 <- ggplot(data = merged,aes(CAP1,CAP2)) +
geom_point(data = mcap$Map_cap,mapping = aes(CAP1,CAP2,color = Genotype),alpha = 0.5,size = 2) +
geom_linerange(mapping = aes(xmin = CAP1 - ci.CAP1,xmax = CAP1 + ci.CAP1),alpha = 0.1) +
geom_linerange(mapping = aes(ymin = CAP2 - ci.CAP2,ymax = CAP2 + ci.CAP2),alpha = 0.1) +
geom_point(aes(color = Genotype),size = 6) +
scale_x_continuous(limits = c(-1.3,2.2),oob = rescale_none) +
scale_y_continuous(limits = c(-1.3,1.3),oob = rescale_none) +
theme_ohchibi() +
scale_shape_manual(values = c(16,15),na.value = 16) +
ggtitle(label = "Root fraction") +
scale_color_manual(values = paleta_gen) +
xlab(label = xlab_id) +
ylab(label = ylab_id) +
theme(
panel.grid.major.x = element_blank(),
panel.grid.major.y = element_blank(),
) +
annotate(geom = "text",x = 2,y = 1,label = annotation_id)
p1
#### Phylogram #####
Dat_rab <- Dat$RelativeAbundance
#Remove batch effect
Tab <- Dat_rab$Tab
Tab_batch <- removeBatchEffect(x = Tab,Dat_rab$Map$Rep)
Dat_batch <- create_dataset(Tab = Tab_batch,Map = Dat_rab$Map,Tax = Dat_rab$Tax)
#Collapse taxonomy
Dat_phyla <- Dat_batch %>%
collapse_by_taxonomy.Dataset(Dat = .,level = 3)
#Split Tab and Map to create another structure
Tab  <- Dat_phyla$Tab
#### Phylogram #####
Dat_rab <- Dat$RelativeAbundance
#Remove batch effect
Tab <- Dat_rab$Tab
Tab_batch <- removeBatchEffect(x = Tab,Dat_rab$Map$Rep)
library(ohchibi)
library(emmeans)
library(Rmisc)
library(palettesPM)
library(multcomp)
library(limma)
library(palettesPM)
install.packages("limma")
rm(list=ls())
gc()
dev.off()
